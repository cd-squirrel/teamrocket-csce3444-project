<!DOCTYPE html>
<html lang="en">
  <head>

    <title>Photodex</title>
    <link rel="stylesheet" href="css/index.css" type="text/css">

    <!-- Below is a bunch of stuff that came with our utilities/software. -->

    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta
      name="photodex"
      content="Cool image gallery site"
    />

    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->

    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->

  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <!-- Nav Bar -->
    <nav class="navbar navbar-expand-md navbar-light bg-light justify-content-center">
      
      <!-- This is the "brand" that goes all the way to the left. -->
      <a class="navbar-brand d-flex w-50 mr-auto" href="index.html">PhotoDex</a>

      <!-- This button replaces the links list when in mobile. -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
    
        <!-- Navbar links -->
        <div class="collapse navbar-collapse" id="nav">
          <!-- Create an unordered list to hold our links and format it automatically. -->
          <ul class="nav navbar-nav mr-auto justify-content-end">
              <!-- All the links in the navbar will be listed below as list items using the <li> tag. -->
              <li class="nav-item">
                  <!-- To make them into links, we use the <a href="link"> tag. -->
                  <!-- The class="nav-link" part just makes them display nicely. -->
                  <a class="nav-link" href="my_albums.html">My Albums</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="login.html">Log in</a>
            </li>
              <li class="nav-item">
                  <a class="nav-link" href="logout.html">Log Out</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link" href="register.html">Register</a>
              </li>
          </ul>
      </div>
    </nav>

    <!-- Page Container -->
    <div class="container-fluid">
      <div class="col align-self-center">
        <br>
        <br>
        <h1>Welcome!</h1>
        <h2>Enter registration information below</h2>
        <form id="reg-form">
          <input type="text" id="username" placeholder="Username" required\>
          <div class="username error"></div>
          <input type="password" id="password" placeholder="Password" required\>
          <div class="password error"></div>
          <input type="submit" value="Register" \>
    
        </form>
    
        <script>
          const form = document.getElementById('reg-form');
          const usernameError = document.querySelector('.username.error');
          const passwordError = document.querySelector('.password.error');

          const handleErrors = (data) => {
            if (data.includes('username')) 
              return usernameError.textContent = data;
            else  
              return passwordError.textContent = data;
          };

          form.addEventListener('submit', async (event) => {

            event.preventDefault();

            //reset errors
            usernameError.textContent = '';
            passwordError.textContent = '';

            const username = form.username.value;
            const password = form.password.value;

            try {
              const result = await fetch('/api/register', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: 
                  JSON.stringify({username, password})
              });

              const data = await result.json();
              console.log(data);

              if (data.login) {
                location.assign('/');
              }
              else {
                handleErrors(data);
              }

            } catch(err) {
              console.log(err);
            }
          });
    
        </script>
        <br>
        <br>
        
        <!-- About section -->
        <div class="row section" id="end-of-page">
        </div>
      </div>
    </div>



  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
